<% unless @won %>
  <form action="<%= submit_guess_game_index_path %>" method="POST" id="guessForm">
    <label>
      <input type="text" list="people" id="personInput" name="person_display" autocomplete="off" autofocus>
      <datalist id="people">
        <% @people.each do |p| %>
          <option data-id="<%= p.quickname %>" value="<%= p.firstName %> <%= p.lastName %>"></option>
        <% end %>
      </datalist>
    </label>
    <input type="hidden" name="selectedPerson" id="selectedPersonHidden">
    <input type="hidden" name="user_id" value="<%= @user_id %>">
    <input type="submit" value="Valider">
  </form>
<% end %>

<div id="congrats-div">
  <%= render partial: "game/congrats", locals: { todays: @todays_person, nb_tries: @nb_tries } if @won %>
</div>

<table>
  <thead>
  <tr>
    <th>Prénom</th>
    <th>Nom</th>
    <th>Sexe</th>
    <th>Localisation</th>
    <th>Statut pro</th>
    <th>Tranche d'âge</th>
  </tr>
  </thead>
  <tbody id="guesses">
  <%= render partial: "people/person",
             collection: @prev_people,
             locals: { todays: @todays_person } if defined?(@prev_people) %>
  </tbody>
</table>

<script>
    document.addEventListener("turbo:submit-end", function (event) {
        if (event.target.id === "guessForm") {
            event.target.reset()
            personInput.focus()
        }
    })
    document.addEventListener("submit", function (event) {
        if (event.target.id === "guessForm") {
            const options = document.querySelectorAll("#people option")
            options.forEach(option => {
                if (option.value === personInput.value)
                    selectedPersonHidden.value = option.getAttribute("data-id")
            })
        }
    })
</script>
